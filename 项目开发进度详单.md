# 项目开发进度详单

## 1. 项目概览
本项目的目标是构建一个基于 RAG (检索增强生成) 的智能 Wiki 知识库系统。项目采用前后端分离架构，后端使用 Python FastAPI，前端使用 Vue 3 (CDN 模式)。目前核心功能原型已完成，可以进行文档管理、文件夹组织以及基于文档内容的 AI 问答。

---

## 2. 已完成功能 (100% 完成度)

### 2.1 后端基础架构
- **框架搭建**: FastAPI 异步框架，集成 `lifespan` 生命周期管理。
- **数据库**:
  - **SQLite/PostgreSQL 支持**: 使用 SQLAlchemy AsyncIO 进行异步数据库操作。
  - **自动建表**: `init_db` 函数在启动时自动检查并创建所有数据表。
- **缓存层**:
  - **Redis 集成**: 实现了 `RedisManager`，支持异步连接池。
  - **内存降级**: 实现了内存缓存降级机制，当 Redis 不可用时自动切换到本地内存字典，保证系统高可用。
- **配置管理**: 基于 `pydantic-settings` 的 `config.py`，支持 `.env` 环境变量加载。

### 2.2 核心业务模块 (Service 层)
- **文档服务 (`DocumentService`)**:
  - 文档创建 (Create): 支持标题、内容、文件夹关联。
  - 文档查询 (Read): 支持单个详情查询和列表查询（带摘要）。
  - 缓存策略: 文档列表查询优先走 Redis 缓存 (TTL 5分钟)，创建文档时自动失效缓存。
- **文件夹服务 (`FolderService`)**:
  - 无限层级: 支持文件夹嵌套 (`parent_id`)。
  - 内容聚合: `get_folder_contents` 可同时返回当前目录下的子文件夹和文档。
- **日志服务 (`LogService`)**:
  - 结构化日志: 记录操作人、动作、资源类型、资源ID、详情 JSON。
  - 异步入库: 通过后台任务将日志写入 `system_logs` 表。
- **图片服务 (`ImageService`)**:
  - 本地存储: 图片上传至 `backend/static/uploads`。
  - 唯一命名: 使用 UUID + 时间戳防止文件名冲突。
- **Agent 服务 (`AgentService`)**:
  - **RAG 流程**: 向量检索 (ChromaDB) -> 上下文构建 -> LLM 回答。
  - **文本处理**: 提供了文本润色 (`polish_text`) 和文本续写 (`complete_text`) 功能。
  - **向量索引**: 文档创建时自动触发后台任务进行文本切片和向量化。

### 2.3 API 接口层 (Controller)
- **RESTful 设计**: 遵循资源导向的 URL 设计 (e.g., `GET /api/v1/documents/{id}`).
- **依赖注入**: 广泛使用 FastAPI `Depends` 注入 Service 实例和 DB Session。
- **中间件**:
  - **CORS**: 允许跨域请求。
  - **请求审计**: `log_requests` 中间件记录所有 API 请求的耗时、状态码和操作人到文件日志。

### 2.4 前端实现 (Frontend)
- **技术栈**: Vue 3 (Composition API) + Element Plus + TailwindCSS (via CDN).
- **功能实现**:
  - **文档树**: 左侧侧边栏展示文件夹和文档结构。
  - **Markdown 编辑器**: 集成 Marked.js 实现实时预览。
  - **AI 助手**: 右下角悬浮聊天窗口，支持普通对话和 RAG 模式。
  - **图片上传**: 编辑器工具栏支持图片上传并插入 Markdown。

---

## 3. 未完成/待优化功能 (待办事项)

### 3.1 核心缺失功能
- **用户鉴权 (Authentication)**:
  - **现状**: 当前用户硬编码为 "Admin" 或 "system"，API 无 Token 验证。
  - **计划**: 集成 OAuth2 + JWT，实现用户注册、登录、角色管理 (RBAC)。
- **高级 RAG 优化**:
  - **现状**: 简单的 Top-K 向量检索。
  - **计划**: 引入 Rerank (重排序) 模型，支持混合检索 (关键词 + 向量)，优化切片策略 (按语义切片)。
- **知识图谱 (Knowledge Graph)**:
  - **现状**: 仅有 `generate_knowledge_graph` 接口雏形，返回简单的 JSON 摘要。
  - **计划**: 引入 GraphDB (如 Neo4j) 或使用 NetworkX 构建内存图谱，实现实体关系可视化。

### 3.2 工程化与运维
- **测试覆盖**:
  - **现状**: 无单元测试和集成测试。
  - **计划**: 添加 `pytest` 测试套件，覆盖 Service 层核心逻辑和 API 接口。
- **部署配置**:
  - **现状**: 依赖手动运行 `uvicorn`。
  - **计划**: 编写 `Dockerfile` 和 `docker-compose.yml`，实现一键部署 (App + Redis + DB)。
- **前端体验**:
  - **现状**: 缺乏全局 Loading 状态，错误提示较为简单。
  - **计划**: 增加请求拦截器统一处理 Loading 和 Error，优化移动端适配。

### 3.3 数据安全
- **现状**: 软删除 (`is_active`) 已实现，但物理删除未实现。
- **计划**: 添加定期清理回收站的任务，敏感数据加密存储。

---

## 4. 文件状态概览

| 文件路径 | 状态 | 备注 |
| :--- | :--- | :--- |
| `backend/app/main.py` | ✅ 完成 | 应用入口，生命周期完备 |
| `backend/app/service.py` | ✅ 完成 | 核心业务逻辑集中于此，代码整洁 |
| `backend/app/models.py` | ✅ 完成 | 数据库模型定义规范，含中文注释 |
| `backend/app/schemas.py` | ✅ 完成 | Pydantic 校验模型完备 |
| `backend/app/api/*.py` | ✅ 完成 | 路由层已重构，无业务逻辑残留 |
| `backend/templates/index.html` | ✅ 完成 | 单页应用入口，已本地化 |
| `backend/static/js/app.js` | ✅ 完成 | 前端逻辑核心，含 AI 对话逻辑 |
| `backend/chroma_db/` | ⚠️ 数据 | 运行时生成，需注意持久化备份 |
| `tests/` | ❌ 缺失 | 需新建测试目录 |
| `Dockerfile` | ❌ 缺失 | 需添加容器化支持 |
