# Redis 连接超时故障报告

## 问题: 资源库加载延迟 (Redis Timeout)
**日期:** 2025-12-29
**状态:** 已解决

### 问题描述
用户报告在加载 Wiki 应用程序的“资源库”页面时存在显著延迟（约 2-3 分钟）。

### 根本原因分析 (Root Cause Analysis)
1.  **Redis 连接超时**: 应用程序配置为连接 Redis 服务器。
2.  **环境不匹配**: 在 Windows 本地环境中，Redis 并未运行。
3.  **阻塞式 IO**: `redis-py` 客户端在连接不存在的服务器时，默认会等待很长的 TCP 超时时间（约 2 分钟），导致主线程阻塞。
4.  **缺乏降级**: 代码没有处理 Redis 连接失败的情况，导致应用挂起。

### 解决方案实施: 混合缓存管理器 (Hybrid Cache Manager)
为了同时满足企业标准（Redis）和本地开发（速度），实现了混合缓存：

1.  **快速失败**: 设置 Redis 连接超时为 1 秒 (`socket_connect_timeout=1`)。
2.  **自动降级**: 捕获连接异常，一旦失败立即切换到内存字典缓存 (`_memory_cache`)。
3.  **无缝体验**: 对上层业务逻辑透明，无论是用 Redis 还是内存，接口保持一致。

### 经验教训 (Lessons Learned)
1.  **环境适应性**: 开发环境和生产环境往往不同。代码应能适应缺失的基础设施（如 Redis），而不是直接崩溃或挂起。
2.  **超时设置**: 网络请求（数据库、缓存、API）必须显式设置合理的超时时间，防止系统因依赖项故障而无限期等待。
