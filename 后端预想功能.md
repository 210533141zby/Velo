第三部分：AI 侧边栏与未来功能建议
侧边栏不应只是一个聊天窗口，它应该是**“文档的副驾驶”**。

1. AI 侧边栏的利用策略
目前 ChatPanel.vue 和 agent_service.py 已经打通了 RAG。可以进一步增强：

"Chat with Selection" (上下文对话)：

痛点：用户选中一段话，想问 AI “这段话怎么改更好？”。

实现：前端将选中的文本作为 context 发送给 ask_ai 接口，而不仅仅是发用户的问题。

"Chat with Current Doc" (单文档 RAG)：

目前 RAG 是检索所有文档。

新功能：在侧边栏增加一个开关“仅限当前文档”。后端 RAG 检索时，在 Chroma 查询中增加过滤条件 where={"doc_id": current_doc_id} (参考你的 delete_document_index 写法)。

大纲与灵感生成：

侧边栏可以有一个“生成大纲”按钮。点击后，AI 读取全文生成 Markdown 大纲，用户可以一键插入到编辑器中。

2. 可以增加的重点功能
自动标签 (Auto-Tagging)：

逻辑：文档保存时 (document_service.update_document)，触发一个后台任务，让 LLM 根据内容生成 3-5 个标签，自动存入 tags 字段。这能极大改善文档管理体验。

双向链接建议 (Backlink Suggestions)：

逻辑：当用户写作时，后端可以异步分析内容，推荐“你可能想链接到名为《XXX》的文档”，因为内容相关度高。

版本回溯 (History/Diff)：

你的 Document 表里有 version 字段，但目前似乎没看到存历史版本的表（如 DocumentHistory）。如果这是个知识库，历史记录是救命的功能。建议增加一张表记录每次保存的快照。