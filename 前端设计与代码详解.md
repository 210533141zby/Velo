# 前端设计与代码详解

## 1. 前端架构设计 (No-Build 模式)

本项目的核心设计理念是 **"轻量化"** 与 **"开箱即用"**。

与现代常见的前端项目 (如使用 Vue CLI, Vite, Webpack) 不同，本项目采用了 **No-Build (无需构建)** 的架构模式。这意味着我们不需要安装 Node.js 环境，不需要 `npm run build`，浏览器直接加载并运行源码。

### 1.1 架构对比

| 特性 | 传统工程化架构 (Vite/Webpack) | 本项目架构 (CDN/No-Build) |
| :--- | :--- | :--- |
| **依赖管理** | `package.json` + `node_modules` | HTML `<script>` 标签 (CDN) |
| **编译过程** | 需要编译 (.vue -> .js) | 无需编译，直接运行 |
| **部署方式** | 需构建产物 (dist) | 直接部署源码 |
| **优点** | 适合超大型项目，生态丰富 | **极简，无需配置，Python 开发者友好** |
| **缺点** | 配置复杂，依赖 Node.js 环境 | 不支持 .vue 单文件组件，无类型检查 |

### 1.2 核心技术栈
*   **Vue 3 (Composition API)**: 核心框架，通过全局对象 `window.Vue` 访问。
*   **TailwindCSS (CDN)**: 原子化 CSS 框架，通过 `<script src="...tailwind.css">` 实时解析类名。
*   **Element Plus (CDN)**: UI 组件库，提供美观的按钮、输入框、对话框。
*   **Marked.js**: 在浏览器端将 Markdown 文本转换为 HTML。
*   **FontAwesome**: 图标库。

---

## 2. 关键文件详解

### 2.1 入口文件 (`backend/templates/index.html`)
这是整个应用的主骨架。

```html
<!-- 1. 引入依赖 -->
<!-- 通过 CDN 直接加载 Vue3, Tailwind, Element Plus 等库 -->
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

<!-- 2. 应用挂载点 -->
<!-- id="app" 是 Vue 实例挂载的容器，整个页面的动态内容都在这里 -->
<div id="app" class="flex w-full h-full">
    <!-- 侧边栏 -->
    <aside>...</aside>
    
    <!-- 主内容区 -->
    <main>
        <!-- Vue 指令 v-if 控制页面切换 -->
        <div v-if="currentView === 'home'">...</div>
        <div v-if="currentView === 'editor'">...</div>
    </main>
</div>

<!-- 3. 引入业务逻辑 -->
<!-- 加载 app.js，其中包含了所有的 Vue 代码 -->
<script src="/static/js/app.js"></script>
```

### 2.2 核心逻辑 (`backend/static/js/app.js`)
这是前端的"大脑"，使用了 Vue 3 的 **Composition API** (组合式 API)。

#### 2.2.1 初始化 Vue 应用
```javascript
// 从全局对象 window.Vue 中解构出需要的函数
const { createApp, ref, computed, onMounted, nextTick, watch } = window.Vue;

const app = createApp({
    setup() {
        // setup() 是 Vue 3 的入口函数
        // 所有的状态变量和方法都在这里定义并返回给 HTML 使用
    }
});
```

#### 2.2.2 响应式状态 (State)
使用 `ref` 定义响应式变量，当变量改变时，界面会自动更新。

```javascript
// 文档列表数据
const documents = ref([]);
// 当前选中的文档对象
const currentDoc = ref(null);
// 控制侧边栏显示的开关
const sidebarOpen = ref(true);
// 聊天窗口的开关
const chatOpen = ref(false);
```

#### 2.2.3 核心方法 (Methods)

**1. 加载文档列表 (`loadLibrary`)**
```javascript
const loadLibrary = async () => {
    loadingDocs.value = true; // 显示加载动画
    try {
        // 调用后端 API 获取数据
        const response = await fetch(`/api/v1/folders/${folderId}/contents`);
        const data = await response.json();
        // 更新响应式变量，界面自动刷新列表
        documents.value = data.documents;
    } catch (e) {
        console.error("加载失败", e);
    } finally {
        loadingDocs.value = false;
    }
};
```

**2. 保存文档 (`saveDocument`)**
```javascript
const saveDocument = async () => {
    saving.value = true; // 显示 "保存中..."
    // 发送 POST 请求将 currentDoc 的内容传给后端
    const res = await fetch('/api/v1/documents/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            title: currentDoc.value.title,
            content: currentDoc.value.content
            // ...
        })
    });
    // ...处理保存成功提示
};
```

**3. AI 对话 (`chatWithAgent`)**
```javascript
const chatWithAgent = async () => {
    // 将用户问题推入聊天记录数组
    chatMessages.value.push({ role: 'user', content: userQuery.value });
    
    // 调用后端 RAG 接口
    const res = await fetch('/api/v1/agent/chat', {
        body: JSON.stringify({ 
            messages: chatMessages.value,
            use_rag: true // 开启检索增强
        })
    });
    
    // 接收后端返回的 AI 回答和参考来源
    const data = await res.json();
    chatMessages.value.push({ 
        role: 'assistant', 
        content: data.response,
        sources: data.sources 
    });
};
```

---

## 3. 关于 `frontend/node_modules` 的疑问

**Q: 既然是 No-Build 模式，为什么项目里还有一个 `frontend` 文件夹且里面有很多 `node_modules`？**

**A: 这是一个典型的"冗余"目录，在当前运行模式下是完全不被使用的。**

*   **来源**: 可能是在项目初期，有人尝试用 Vue CLI 或 Vite 初始化了一个标准的 Vue 工程 (`package.json` 里的 `element-plus`, `vue-router` 等依赖证明了这一点)。
*   **现状**: 我们目前的 `index.html` 并没有引用 `frontend` 目录下的任何构建产物，而是直接引用的 CDN 链接。
*   **结论**: 如果你只运行 Python 后端 (`main.py`)，**`frontend` 文件夹及其中的 `node_modules` 是完全可以删除的**，不会影响项目运行。

---

## 4. 如何启动项目

由于前端是嵌入在后端模板中的，你只需要启动后端服务即可。

### 4.1 启动步骤
1.  **进入后端目录**:
    ```bash
    cd backend
    ```
2.  **启动 FastAPI 服务**:
    ```bash
    # 使用 uvicorn 启动，开启热重载 (--reload)
    uvicorn app.main:app --reload
    ```
3.  **访问应用**:
    打开浏览器访问 `http://127.0.0.1:8000` 即可看到界面。

### 4.2 为什么不需要启动前端？
因为 `backend/templates/index.html` 就是前端页面。当你访问 `localhost:8000` 时，FastAPI 会读取这个 HTML 文件并返回给浏览器。浏览器解析 HTML 时，会自动去 CDN 下载 Vue.js 和 TailwindCSS，然后执行 `app.js` 里的逻辑。整个过程不需要 Node.js 服务器参与。
